# Function to generate HTML table for folder comparison result
function Generate-FolderComparisonHTMLTable {
    param (
        [string]$sourceFolder,
        [array]$destinationFolders
    )

    $htmlTable = "<h2>Folder Comparison Report</h2>"
    $htmlTable += "<table border='1'><tr><th>Folder Name</th><th>Size (KB)</th><th>Last Write Time</th><th>Result</th></tr>"

    foreach ($destinationFolder in $destinationFolders) {
        # Get information for source folder
        $sourceFolderInfo = Get-Item -LiteralPath $sourceFolder
        $sourceSizeInKB = [math]::Ceiling($sourceFolderInfo.Length / 1KB)
        $sourceLastWriteTime = $sourceFolderInfo.LastWriteTime

        # Get information for destination folder
        $destinationFolderInfo = Get-Item -LiteralPath $destinationFolder
        $destinationSizeInKB = [math]::Ceiling($destinationFolderInfo.Length / 1KB)
        $destinationLastWriteTime = $destinationFolderInfo.LastWriteTime

        # Compare source and destination folders
        $result = if ($sourceSizeInKB -eq $destinationSizeInKB -and $sourceLastWriteTime -eq $destinationLastWriteTime) {
            "Matching"
        } else {
            "Not Matching"
        }

        # Generate HTML table row
        $htmlTable += "<tr>"
        $htmlTable += "<td>$destinationFolder</td>"
        $htmlTable += "<td>$destinationSizeInKB KB</td>"
        $htmlTable += "<td>$destinationLastWriteTime</td>"
        $htmlTable += "<td>$result</td>"
        $htmlTable += "</tr>"
    }

    $htmlTable += "</table>"
    return $htmlTable
}

# Function to calculate total folder size including subfolders
function Get-TotalFolderSize {
    param (
        [string]$folderPath
    )

    $totalSize = 0

    # Calculate total size including subfolders
    Get-ChildItem -LiteralPath $folderPath -Recurse |
    ForEach-Object {
        $totalSize += $_.Length
    }

    return [math]::Ceiling($totalSize / 1KB)
}

# Configuration
$sourceFolder = "C:\Path\To\Source\Folder"
$destinationFolders = @("C:\Path\To\Destination\Folder1", "C:\Path\To\Destination\Folder2")

# Generate HTML report for folder comparison
$htmlComparisonReport = Generate-FolderComparisonHTMLTable -sourceFolder $sourceFolder -destinationFolders $destinationFolders

# Calculate and display total size for each folder
$htmlTotalSizeReport = "<h2>Total Folder Size Report</h2><table border='1'><tr><th>Folder Name</th><th>Total Size (KB)</th><th>Last Write Time</th></tr>"
foreach ($folder in ($sourceFolder, $destinationFolders)) {
    $totalSize = Get-TotalFolderSize -folderPath $folder
    $lastWriteTime = (Get-Item -LiteralPath $folder).LastWriteTime
    $htmlTotalSizeReport += "<tr><td>$folder</td><td>$totalSize KB</td><td>$lastWriteTime</td></tr>"
}
$htmlTotalSizeReport += "</table>"

# Combine reports
$htmlReport = $htmlComparisonReport + $htmlTotalSizeReport

# Save HTML report to a file
$htmlReport | Out-File -FilePath "C:\Path\To\Your\FolderComparisonReport.html" -Encoding UTF8

# Display success message
Write-Host "Folder comparison report generated successfully at C:\Path\To\Your\FolderComparisonReport.html"
