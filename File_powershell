# Install Import-Excel module if not already installed
Install-Module Import-Excel -Scope CurrentUser -Force

# Import the Import-Excel module
Import-Module Import-Excel

# Specify the input Excel file path
$inputExcelPath = "C:\Path\to\input.xlsx"

# Specify the default destination path
$destinationPath = "C:\Destination\"

# Specify the name of the data table in the Excel file
$dataTableName = "Sheet1"  # Update with the actual name of your data table

# Specify the name of the column containing folder paths in the data table
$folderPathColumnName = "FolderPath"

# Read the Excel file
$excelData = Import-Excel -Path $inputExcelPath -WorksheetName $dataTableName

# Check if the 'FolderPath' column exists in the Excel data
if ($excelData[0].PSObject.Properties.Name -contains $folderPathColumnName) {
    # Get the folder paths from the 'FolderPath' column
    $folderPaths = $excelData | Select-Object -ExpandProperty $folderPathColumnName

    # Iterate through each folder path
    foreach ($folderPath in $folderPaths) {
        # Check if the folder path exists
        if (Test-Path $folderPath -PathType Container) {
            # Get all files in the folder
            $files = Get-ChildItem -Path $folderPath

            # Check if there are files in the folder
            if ($files.Count -gt 0) {
                # Copy each file to the destination path
                foreach ($file in $files) {
                    Copy-Item -Path $file.FullName -Destination $destinationPath -Force
                }
                Write-Host "Files copied from $($folderPath) to $($destinationPath)"
            } else {
                Write-Warning "No files found in folder path: $($folderPath)"
            }
        } else {
            Write-Warning "Folder path $($folderPath) does not exist."
        }
    }
} else {
    Write-Warning "Column '$folderPathColumnName' not found in the Excel data table."
}
